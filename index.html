<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>VR Goal</title>
<style>
body{margin:0;background:#111;font-family:sans-serif;color:#fff}
.wrap{max-width:900px;margin:auto;padding:20px}
canvas{width:100%;border-radius:20px;background:#111}
.top{display:flex;justify-content:space-between;margin-bottom:10px}
button{padding:8px 14px;background:#151515;border:1px solid #333;color:#fff;border-radius:10px;cursor:pointer}
</style>
</head>
<body>
<div class="wrap">
<div class="top">
<div id="info"></div>
<button onclick="render()">렌더</button>
</div>
<canvas id="c" width="1179" height="2556"></canvas>
</div>

<script>
const startDate = new Date("2021-12-05");
const goalDate  = new Date("2031-12-05");

const W = 1179;
const H = 2556;

const canvas = document.getElementById("c");
const ctx = canvas.getContext("2d");

const SAFE_TOP = H*0.16;
const SAFE_BOTTOM = H*0.18;

const COL_W = W*0.72;
const COL_X = (W-COL_W)/2;

const C_PAST = "#ffffff";
const C_FUTURE = "rgba(255,255,255,.25)";
const C_DOT = "rgba(255,255,255,.15)";
const C_DONE = "#ffffff";
const C_NOW = "#ff6a2a";

function days(a,b){return Math.floor((b-a)/86400000)}

function line(x1,y,x2,w,c){
ctx.strokeStyle=c;
ctx.lineWidth=w;
ctx.lineCap="round";
ctx.beginPath();
ctx.moveTo(x1,y);
ctx.lineTo(x2,y);
ctx.stroke();
}

function clear(){
ctx.fillStyle="#111";
ctx.fillRect(0,0,W,H);
}

function drawPast(today){
let years=[];
for(let y=startDate.getFullYear();y<today.getFullYear();y++)years.push(y);

let y=SAFE_TOP+60;
for(let i=0;i<years.length;i++){
line(COL_X+20,y,COL_X+COL_W-20,6,C_PAST);
y+=18;
}
return y;
}

function drawFuture(today,startY){
let years=[];
for(let y=today.getFullYear()+1;y<=goalDate.getFullYear();y++)years.push(y);

let y=startY;
for(let i=0;i<years.length;i++){
line(COL_X+20,y,COL_X+COL_W-20,6,C_FUTURE);
y+=18;
}
return y;
}

function drawYear(today,y){
ctx.fillStyle="#fff";
ctx.textAlign="center";
ctx.font="700 80px serif";
ctx.fillText(today.getFullYear(),W/2,y);
}

function drawMonths(today,startY){
let mNames=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];
let cellW=(COL_W-100)/3;
let dotGap=10;
let dot=12;

let y=startY;
for(let m=0;m<12;m++){
let cx=m%3;
let cy=Math.floor(m/3);
let x=COL_X+cx*(cellW+50);
let yy=y+cy*260;

ctx.fillStyle="rgba(255,255,255,.5)";
ctx.font="600 20px sans-serif";
ctx.textAlign="left";
ctx.fillText(mNames[m],x,yy);

let first=new Date(today.getFullYear(),m,1).getDay();
let daysM=new Date(today.getFullYear(),m+1,0).getDate();

for(let i=0;i<42;i++){
let dx=i%7;
let dy=Math.floor(i/7);

let px=x+dx*(dot+dotGap);
let py=yy+25+dy*(dot+dotGap);

let day=i-first+1;

ctx.fillStyle=C_DOT;

if(day>=1&&day<=daysM){
let d=new Date(today.getFullYear(),m,day);
if(d<today)ctx.fillStyle=C_DONE;
if(d>today)ctx.fillStyle=C_DOT;
if(d.toDateString()==today.toDateString())ctx.fillStyle=C_NOW;
}

ctx.beginPath();
ctx.arc(px,py,dot/2,0,6.28);
ctx.fill();
}
}
return y+4*260;
}

function drawFooter(today){
let total=days(startDate,goalDate);
let done=Math.max(0,days(startDate,today));
let pct=Math.floor(done/total*100);
let left=Math.max(0,days(today,goalDate));

let y=H-SAFE_BOTTOM/2;

ctx.textAlign="center";
ctx.font="600 32px sans-serif";

let t1=`${left}d left`;
let t2=` · ${pct}%`;

let w1=ctx.measureText(t1).width;
let w2=ctx.measureText(t2).width;

let start=W/2-(w1+w2)/2;

ctx.fillStyle="#ff6a2a";
ctx.fillText(t1,start+w1/2,y);

ctx.fillStyle="rgba(255,255,255,.5)";
ctx.fillText(t2,start+w1+w2/2,y);

document.getElementById("info").innerText=`${left}d left · ${pct}%`;
}

function render(){
let today=new Date();
clear();

let topEnd=drawPast(today);
let yearY=topEnd+120;

drawYear(today,yearY);

let calStart=yearY+80;
let calEnd=drawMonths(today,calStart);

drawFuture(today,calEnd+40);
drawFooter(today);
}

render();
</script>
</body>
</html>
